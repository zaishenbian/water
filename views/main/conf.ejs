<%- contentFor('style') %>
<title>配置</title>
<style>
  .hide{
    height: 0;
    visibility: hidden;
  }

  .weui-label {
    width: 140px;
  }

  .weui-cell {
    padding: 20px 10px;
  }

  .weui-select {
    padding: 0;
  }

  .editConfig,
  .submit {
    margin-top: 50px;
  }
</style>

<%- contentFor('content') %>
<form id="configForm">
  <div class="weui-cells weui-cells_form">
    <div class="weui-cell">
      <div class="weui-cell__hd">
        <label class="weui-label">设备号</label>
      </div>
      <div class="weui-cell__bd">
        <input class="weui-input" readonly type="text" required name="deviceId" placeholder="请输入设备号" tip="设备号" value="<%= result.deviceId %>">
      </div>
    </div>
    <div class="weui-cell editable" style="height:26px;">
      <div class="weui-cell__hd">
        <label class="weui-label">每次送几桶</label>
      </div>
      <div class="weui-cell__bd">
        <input class="weui-input" <%= status===1000?'readonly':'' %> pattern="[0-9]+" tip="送水桶数" type="number" required name="bucketNumber" placeholder="请输入每次送水桶数">
      </div>
    </div>
    <div class="weui-cell editable">
      <div class="weui-cell__hd">
        <label class="weui-label">送水地址</label>
      </div>
      <div class="weui-cell__bd">
        <input class="weui-input" <%= status===1000?'readonly':'' %> type="text" required name="userAddress" tip="送水地址" placeholder="请输入送水地址">
      </div>
    </div>
    <div class="weui-cell editable">
      <div class="weui-cell__hd">
        <label class="weui-label">您的姓名</label>
      </div>
      <div class="weui-cell__bd">
        <input class="weui-input" <%= status===1000?'readonly':'' %> type="text" required name="userName" pattern="[\u4e00-\u9fa5]+" tip="姓名" placeholder="请输入姓名">
      </div>
    </div>
    <div class="weui-cell editable weui-cell_vcode">
      <div class="weui-cell__hd">
        <label class="weui-label">您的手机号</label>
      </div>
      <div class="weui-cell__bd">
        <input class="weui-input" <%= status===1000?'readonly':'' %> type="tel" required name="userPhone" pattern="^1[3|4|5|7|8]\d{9}$" tip="手机号" placeholder="请输入手机号">
      </div>
      <div class="weui-cell__ft <%= status===1000?'hide':'' %>">
        <button class="weui-vcode-btn getCode">获取验证码</button>
      </div>
    </div>
    <div class="weui-cell editable <%= status===1000?'hide':'' %>">
      <div class="weui-cell__hd">
        <label class="weui-label">验证码</label>
      </div>
      <div class="weui-cell__bd">
        <input class="weui-input" <%= status===1000?'readonly':'' %> type="number" required name="validateCode" pattern="[0-9]{4}" tip="验证码" placeholder="请输入验证码">
      </div>
    </div>
    <div class="weui-cell editable">
      <div class="weui-cell__hd">
        <label class="weui-label">备注信息</label>
      </div>
      <div class="weui-cell__bd remarkContent">
        <textarea class="weui-textarea" placeholder="请输入备注信息" <%= status===1000?'readonly':'' %> rows="3"></textarea>
        <div class="weui-textarea-counter"><span class="textNum">0</span>/200</div>
      </div>
    </div>
  </div>
  <div style="padding:10px;">
    <a href="javascript:;" class="weui-btn weui-btn_primary <%= status===1000?'editConfig':'submit' %>"><%= status===1000?'修改配置':'确定' %></a>
  </div>
</form>

<%- contentFor('script') %>
<script>
  var configForm = $('#configForm');
  var getCode = $('#configForm .getCode');
  var textarea = $('.remarkContent');
  var textNum = $('.textNum');
  var editableInput = $('.editable input,textarea');
  var hideInput = $('.hide');
  var submitData = {};
  //获取验证码
  getCode.click(function() {
    return false;
  });
  //限制问题反馈字数
  textarea.on('input propertychange','textarea',function(){
    var val = $(this).val();
    if(val.length<201){
        textNum.html(val.length);
    }else{
        textarea.find('textarea').val(val.substring(0,200));
    }
  });
  //开始编辑
  $(document).on('click', '.editConfig', function() {
    editableInput.removeProp('readonly');
    hideInput.removeClass('hide');
    $(this).removeClass('editConfig').addClass('submit').html('确定');
  });
  //表单提交
  $(document).on('click', '.submit', function () {
    //表单验证
    var inp = $('#configForm input');
    var verifyBtn = false;
    inp.each(function (index, item) {
      var val = $(item).val();
      var required = $(item).attr('required');
      var reg = new RegExp($(item).attr('pattern'), 'g');
      var tip = $(item).attr('tip');
      //验证是否为空
      if (val == '' && required) {
        $.alert(tip+"不能为空", "温馨提示", function () {
          $(item).focus();
        });
        verifyBtn = true;
        return false;
      }
      //验证是否符合规则
      if (!reg.test(val)) {
        $.alert("请输入正确的" + tip, "温馨提示", function () {
          $(item).focus();
        });
        verifyBtn = true;
        return false;
      }
    })
    //表单序列化
    if (!verifyBtn) {
      submitData = configForm.serializeJson();
      console.log(submitData);
    }
  })

</script>